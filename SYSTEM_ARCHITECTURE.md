# ğŸ—ï¸ ASEAGI System Architecture

Technical architecture documentation for the Advanced System for Evidence Analysis and Gathering Intelligence.

---

## ğŸ“– Table of Contents

1. [Architecture Overview](#architecture-overview)
2. [System Components](#system-components)
3. [Data Flow](#data-flow)
4. [Database Schema](#database-schema)
5. [API Specifications](#api-specifications)
6. [Security Architecture](#security-architecture)
7. [Deployment Architecture](#deployment-architecture)
8. [Integration Points](#integration-points)
9. [Scalability & Performance](#scalability--performance)
10. [Disaster Recovery](#disaster-recovery)

---

## Architecture Overview

### High-Level System Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Telegram   â”‚  â”‚   Streamlit  â”‚  â”‚     CLI      â”‚  â”‚   Browser    â”‚â”‚
â”‚  â”‚   Mobile     â”‚  â”‚  Dashboards  â”‚  â”‚    Tools     â”‚  â”‚   (n8n UI)   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚                 â”‚
          â”‚ HTTPS/WSS       â”‚ HTTPS           â”‚ HTTPS           â”‚ HTTPS
          â”‚                 â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â–¼                 â–¼                 â–¼                 â–¼         â”‚
â”‚                       APPLICATION LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Telegram Bot API   â”‚  â”‚   Streamlit Apps    â”‚  â”‚  n8n Workflows  â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚ â€¢ Document Bot      â”‚  â”‚ â€¢ Upload Dashboard  â”‚  â”‚ â€¢ Processing    â”‚ â”‚
â”‚  â”‚ â€¢ Monitoring Bot    â”‚  â”‚ â€¢ Master Dashboard  â”‚  â”‚ â€¢ Notifications â”‚ â”‚
â”‚  â”‚ â€¢ Shepherd Bot      â”‚  â”‚ â€¢ Timeline Viewer   â”‚  â”‚ â€¢ Error Handler â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚                        â”‚                       â”‚          â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                             â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ SQL/REST
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â–¼                                           â”‚
â”‚                       DATA LAYER                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Supabase (PostgreSQL 15)                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ telegram_    â”‚  â”‚ processing_  â”‚  â”‚ storage_registry   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   uploads    â”‚  â”‚     logs     â”‚  â”‚                    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚notification_ â”‚  â”‚    legal_    â”‚  â”‚   user_           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    queue     â”‚  â”‚  documents   â”‚  â”‚  preferences       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Row Level Security (RLS)                                     â”‚   â”‚
â”‚  â”‚  â€¢ Real-time subscriptions                                      â”‚   â”‚
â”‚  â”‚  â€¢ Automated backups (PITR)                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ REST API
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â–¼                                           â”‚
â”‚                      STORAGE LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   AWS S3       â”‚  â”‚ Google Drive   â”‚  â”‚  Backblaze B2          â”‚    â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                        â”‚    â”‚
â”‚  â”‚ â€¢ Primary      â”‚  â”‚ â€¢ Backup       â”‚  â”‚ â€¢ Archive              â”‚    â”‚
â”‚  â”‚ â€¢ Hot storage  â”‚  â”‚ â€¢ Sync         â”‚  â”‚ â€¢ Cold storage         â”‚    â”‚
â”‚  â”‚ â€¢ Fast access  â”‚  â”‚ â€¢ Share        â”‚  â”‚ â€¢ Long-term            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â–¼                                           â”‚
â”‚                    INTELLIGENCE LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Claude AI     â”‚  â”‚    Qdrant      â”‚  â”‚   Twelve Labs          â”‚    â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                        â”‚    â”‚
â”‚  â”‚ â€¢ Code review  â”‚  â”‚ â€¢ Vector DB    â”‚  â”‚ â€¢ Video AI             â”‚    â”‚
â”‚  â”‚ â€¢ Q&A          â”‚  â”‚ â€¢ Semantic     â”‚  â”‚ â€¢ Scene detection      â”‚    â”‚
â”‚  â”‚ â€¢ Analysis     â”‚  â”‚   search       â”‚  â”‚ â€¢ Transcription        â”‚    â”‚
â”‚  â”‚ â€¢ Impact       â”‚  â”‚ â€¢ Embeddings   â”‚  â”‚ â€¢ Object detection     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â–¼                                           â”‚
â”‚                    INTEGRATION LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    GitHub      â”‚  â”‚   Airtable     â”‚  â”‚   Webhook Endpoints    â”‚    â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                        â”‚    â”‚
â”‚  â”‚ â€¢ Code repo    â”‚  â”‚ â€¢ External     â”‚  â”‚ â€¢ Event receivers      â”‚    â”‚
â”‚  â”‚ â€¢ CI/CD        â”‚  â”‚   review       â”‚  â”‚ â€¢ Integrations         â”‚    â”‚
â”‚  â”‚ â€¢ Issues       â”‚  â”‚ â€¢ Collaborationâ”‚  â”‚ â€¢ Triggers             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Architecture Principles

1. **Mobile-First**
   - Primary interface is Telegram
   - Optimized for smartphone use
   - Offline-capable where possible

2. **Event-Driven**
   - Webhooks trigger processing
   - Async notification delivery
   - Decoupled components

3. **Multi-Tier Storage**
   - Hot: S3 for immediate access
   - Warm: Google Drive for backup
   - Cold: Backblaze for archives

4. **Complete Audit Trail**
   - Every action logged
   - Processing stages tracked
   - Timestamps on all records

5. **Security First**
   - RLS on all tables
   - Encrypted at rest and in transit
   - API key rotation
   - Minimal permissions

6. **AI-Augmented**
   - Claude for intelligence
   - Qdrant for semantic search
   - Automated analysis

---

## System Components

### 1. Telegram Bots

#### Document Upload Bot
**File:** `telegram_document_bot.py`
**Port:** N/A (Telegram Bot API)
**Purpose:** Document ingestion

**Components:**
```python
class DocumentBot:
    - ConversationHandler (state machine)
    - MessageHandler (file uploads)
    - CommandHandler (/start, /help, /cancel)
    - CallbackQueryHandler (inline buttons)
```

**States:**
1. `DOCUMENT_TYPE` - Select type (PLCR, DECL, etc.)
2. `DOCUMENT_DATE` - Enter date
3. `DOCUMENT_TITLE` - Enter title
4. `DOCUMENT_NOTES` - Add notes
5. `RELEVANCY_SCORE` - Rate relevancy
6. `CONFIRM` - Review and confirm

**Database Operations:**
- INSERT into `telegram_uploads`
- SELECT from `user_preferences`

**External Calls:**
- n8n webhook (POST)
- Supabase API (REST)

#### Monitoring Bot
**File:** `telegram_monitoring_bot.py`
**Purpose:** Global system monitoring

**Monitored Services:**
- GitHub (PyGithub)
- n8n (REST API)
- Qdrant (REST API)
- Twelve Labs (REST API)

**Update Frequency:**
- Real-time on command
- Scheduled checks: Every 5 minutes (optional)

#### Shepherd Bot Integration
**File:** Integrated into `claude_shepherd_agent.py`
**Purpose:** AI-powered assistance

**Commands:**
- `/shepherd_*` (8 commands)
- Uses Claude API
- Queries Qdrant
- Accesses Supabase

### 2. n8n Workflows

#### Processing Workflow
**Nodes:** 19
**Trigger:** Webhook
**Frequency:** Event-driven

**Node Breakdown:**
```
1. Webhook Trigger          â†’ Receive upload data
2. Validate Upload          â†’ Check file type/size
3. Log Validation           â†’ INSERT processing_logs
4. Update Status (Processing) â†’ UPDATE telegram_uploads
5. Get File Path            â†’ Telegram getFile API
6. Extract Download URL     â†’ Parse response
7. Download File            â†’ HTTP request
8. Upload to S3             â†’ AWS S3 PUT
9. Insert Storage Record    â†’ INSERT storage_registry
10. Update Status (Completed) â†’ UPDATE telegram_uploads
11. Queue Notification      â†’ INSERT notification_queue
12. Response (Success)      â†’ HTTP 200

Error Path (13-19):
13. Catch Error             â†’ Error handler
14. Log Error               â†’ INSERT processing_logs (failed)
15. Update Status (Failed)  â†’ UPDATE telegram_uploads (failed)
16. Queue Error Notification â†’ INSERT notification_queue
17. Response (Error)        â†’ HTTP 500
```

**Credentials Required:**
- Supabase (connection string + service role key)
- Telegram Bot (token)
- AWS S3 (access key + secret + bucket)

#### Notification Workflow
**Nodes:** 8
**Trigger:** Schedule (cron)
**Frequency:** Every 30 seconds

**Node Breakdown:**
```
1. Schedule Trigger         â†’ */30 * * * * (every 30s)
2. Get Pending             â†’ SELECT WHERE status='pending'
3. IF Check                â†’ notifications.length > 0
4. Send Message            â†’ Telegram sendMessage API
5. Mark Sent               â†’ UPDATE status='sent'
6. Error Handler           â†’ Catch send failures
7. Mark Failed/Retry       â†’ UPDATE status='failed' OR retry_count++
8. No-op                   â†’ End if no notifications
```

### 3. Dashboards (Streamlit)

#### Upload Dashboard
**File:** `telegram_uploads_dashboard.py`
**Port:** 8501 (default)
**Pages:** 5 tabs

**Tabs:**
1. **Overview**
   - System statistics
   - Recent activity chart
   - Success rate gauge
   - Storage usage

2. **Upload History**
   - Filterable table
   - Search by title/type/date
   - Status color coding
   - Export to CSV

3. **Processing Logs**
   - Timeline visualization
   - Stage breakdown
   - Error details
   - Duration analysis

4. **Storage Management**
   - Multi-cloud tracking
   - File locations
   - Size breakdown
   - Verification status

5. **Quick Actions**
   - Retry failed uploads
   - Generate reports
   - Cleanup old files
   - Bulk operations

**Data Refresh:**
- Auto-refresh: Every 30 seconds
- Manual refresh: Button
- Real-time updates: Supabase subscriptions (optional)

#### Master Dashboard
**File:** `proj344_master_dashboard.py`
**Purpose:** Case D22-03244 overview

**Sections:**
- Case summary
- Document count by type
- Timeline visualization
- Key findings
- Evidence strength

#### Timeline Dashboard
**File:** `timeline_constitutional_violations.py`
**Purpose:** Violation timeline

**Features:**
- Interactive timeline
- Event filtering
- Correlation analysis
- Export to PDF

### 4. Claude Shepherd Agent

**File:** `claude_shepherd_agent.py`
**Type:** CLI + Python API + Telegram integration

**Classes:**

#### RepositoryIndexer
```python
class RepositoryIndexer:
    Methods:
    - index_repository()         â†’ Index all files to Qdrant
    - _get_embedding(text)       â†’ Generate embeddings
    - _chunk_file(content)       â†’ Split large files
```

#### ClaudeShepherdAgent
```python
class ClaudeShepherdAgent:
    Code Methods:
    - review_code()              â†’ AI code review
    - review_pr()                â†’ Full PR analysis
    - answer_question()          â†’ RAG-powered Q&A
    - analyze_architecture()     â†’ Repo structure analysis
    - generate_documentation()   â†’ Auto-generate docs

    Database Methods:
    - monitor_ingestion_tables() â†’ Real-time monitoring
    - generate_case_impact_report() â†’ Legal analysis
    - monitor_schema_changes()   â†’ Schema health
    - analyze_document_relevance() â†’ Document deep dive
```

**API Integrations:**
- Anthropic Claude API (Sonnet 4)
- GitHub API (repository access)
- Qdrant API (vector search)
- Supabase API (database queries)

**Token Limits:**
- Input: 200k tokens
- Output: 8k tokens
- Cost: ~$3 per million input tokens

---

## Data Flow

### Document Upload Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Initiates Upload                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User (Telegram Mobile)                                               â”‚
â”‚ â€¢ Opens chat with bot                                                â”‚
â”‚ â€¢ Sends /start                                                       â”‚
â”‚ â€¢ Uploads file (photo/PDF/document)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Telegram Bot API (HTTPS)
                       â”‚ Message object
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Telegram Bot Receives Upload                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ telegram_document_bot.py                                             â”‚
â”‚ â€¢ handle_document() triggered                                        â”‚
â”‚ â€¢ Extract: file_id, file_type, file_size                            â”‚
â”‚ â€¢ Enter ConversationHandler                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Interactive messages
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Metadata Collection (Conversational)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User provides:                                                       â”‚
â”‚ â€¢ Document type â†’ "PLCR" (Police Report)                            â”‚
â”‚ â€¢ Document date â†’ "20240804"                                         â”‚
â”‚ â€¢ Title â†’ "Richmond PD Report 24-7889"                              â”‚
â”‚ â€¢ Notes â†’ "Initial incident report..."                              â”‚
â”‚ â€¢ Relevancy â†’ "920" (Critical)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ All metadata collected
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Database Insert                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase (telegram_uploads table)                                   â”‚
â”‚                                                                      â”‚
â”‚ INSERT INTO telegram_uploads (                                      â”‚
â”‚   telegram_user_id,                                                 â”‚
â”‚   file_id,                                                          â”‚
â”‚   file_type,                                                        â”‚
â”‚   document_type,                                                    â”‚
â”‚   document_title,                                                   â”‚
â”‚   document_date,                                                    â”‚
â”‚   user_notes,                                                       â”‚
â”‚   relevancy_score,                                                  â”‚
â”‚   status                                                            â”‚
â”‚ ) VALUES (                                                          â”‚
â”‚   123456789,                                                        â”‚
â”‚   'AgACAgIAAxkBAAI...',                                            â”‚
â”‚   'photo',                                                          â”‚
â”‚   'PLCR',                                                           â”‚
â”‚   'Richmond PD Report 24-7889',                                     â”‚
â”‚   '2024-08-04',                                                     â”‚
â”‚   'Initial incident report...',                                     â”‚
â”‚   920,                                                              â”‚
â”‚   'received'                                                        â”‚
â”‚ );                                                                  â”‚
â”‚                                                                      â”‚
â”‚ â†’ Returns: UUID (upload_id)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ INSERT success
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Trigger n8n Webhook                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP POST to n8n webhook                                            â”‚
â”‚                                                                      â”‚
â”‚ POST https://n8n.example.com/webhook/telegram-upload                â”‚
â”‚                                                                      â”‚
â”‚ Body:                                                                â”‚
â”‚ {                                                                    â”‚
â”‚   "upload_id": "a1b2c3d4-...",                                      â”‚
â”‚   "file_id": "AgACAgIAAxkBAAI...",                                 â”‚
â”‚   "file_type": "photo",                                             â”‚
â”‚   "telegram_user_id": 123456789                                     â”‚
â”‚ }                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Webhook received
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: n8n Processing Workflow                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 1: Webhook Trigger                                             â”‚
â”‚ â€¢ Receive data                                                       â”‚
â”‚ â€¢ Parse JSON                                                         â”‚
â”‚ â€¢ Extract upload_id                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2-4: Validation & Logging                                      â”‚
â”‚ â€¢ Validate file type (PDF, JPG, PNG allowed)                        â”‚
â”‚ â€¢ Check file size (<10MB)                                           â”‚
â”‚ â€¢ Log to processing_logs (stage: 'validation')                      â”‚
â”‚ â€¢ Update telegram_uploads (status: 'processing')                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Validation passed
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 5-7: File Download from Telegram                               â”‚
â”‚ â€¢ GET https://api.telegram.org/bot{token}/getFile?file_id=...      â”‚
â”‚ â€¢ Extract file_path from response                                   â”‚
â”‚ â€¢ Download file to temporary location                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ File downloaded
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 8: Upload to AWS S3                                            â”‚
â”‚                                                                      â”‚
â”‚ PUT https://s3.amazonaws.com/{bucket}/{key}                         â”‚
â”‚                                                                      â”‚
â”‚ Key format: {user_id}/{date}/{uuid}_{filename}                     â”‚
â”‚ Example: 123456789/2024-08-04/a1b2c3d4_report.pdf                  â”‚
â”‚                                                                      â”‚
â”‚ Metadata:                                                            â”‚
â”‚ â€¢ Content-Type: application/pdf                                     â”‚
â”‚ â€¢ x-amz-meta-upload-id: a1b2c3d4-...                               â”‚
â”‚ â€¢ x-amz-meta-document-type: PLCR                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ S3 upload complete
                       â”‚ Returns: S3 URL
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 9: Insert Storage Registry                                     â”‚
â”‚                                                                      â”‚
â”‚ INSERT INTO storage_registry (                                      â”‚
â”‚   file_hash,                                                        â”‚
â”‚   primary_storage_provider,                                         â”‚
â”‚   primary_storage_url,                                              â”‚
â”‚   file_size,                                                        â”‚
â”‚   mime_type                                                         â”‚
â”‚ ) VALUES (                                                          â”‚
â”‚   'sha256:abc123...',                                               â”‚
â”‚   's3',                                                             â”‚
â”‚   'https://s3.amazonaws.com/bucket/key',                           â”‚
â”‚   2456789,                                                          â”‚
â”‚   'application/pdf'                                                 â”‚
â”‚ );                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 10: Update Status (Completed)                                  â”‚
â”‚                                                                      â”‚
â”‚ UPDATE telegram_uploads                                             â”‚
â”‚ SET status = 'completed',                                           â”‚
â”‚     permanent_storage_url = 'https://s3...',                       â”‚
â”‚     storage_provider = 's3',                                        â”‚
â”‚     processing_duration_seconds = 12,                               â”‚
â”‚     updated_at = NOW()                                              â”‚
â”‚ WHERE id = 'a1b2c3d4-...';                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 11: Queue Notification                                         â”‚
â”‚                                                                      â”‚
â”‚ INSERT INTO notification_queue (                                    â”‚
â”‚   telegram_user_id,                                                 â”‚
â”‚   telegram_chat_id,                                                 â”‚
â”‚   notification_type,                                                â”‚
â”‚   message,                                                          â”‚
â”‚   status,                                                           â”‚
â”‚   priority                                                          â”‚
â”‚ ) VALUES (                                                          â”‚
â”‚   123456789,                                                        â”‚
â”‚   123456789,                                                        â”‚
â”‚   'upload_success',                                                 â”‚
â”‚   'âœ… Upload complete! Richmond PD Report 24-7889 processed.',    â”‚
â”‚   'pending',                                                        â”‚
â”‚   5                                                                 â”‚
â”‚ );                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 12: Return Success Response                                    â”‚
â”‚                                                                      â”‚
â”‚ HTTP 200 OK                                                         â”‚
â”‚ {                                                                    â”‚
â”‚   "success": true,                                                  â”‚
â”‚   "upload_id": "a1b2c3d4-...",                                     â”‚
â”‚   "status": "completed"                                             â”‚
â”‚ }                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Notification Delivery                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ n8n Notification Workflow (cron: every 30s)                         â”‚
â”‚                                                                      â”‚
â”‚ â€¢ SELECT FROM notification_queue WHERE status='pending'             â”‚
â”‚ â€¢ FOR EACH notification:                                            â”‚
â”‚   - POST to Telegram sendMessage API                                â”‚
â”‚   - UPDATE status='sent', sent_at=NOW()                            â”‚
â”‚   - IF error: UPDATE status='failed', retry_count++                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User receives confirmation message                                   â”‚
â”‚                                                                      â”‚
â”‚ âœ… Upload complete!                                                 â”‚
â”‚ Richmond PD Report 24-7889                                          â”‚
â”‚ Type: Police Report                                                 â”‚
â”‚ Date: 2024-08-04                                                    â”‚
â”‚ Relevancy: 920 (Critical)                                           â”‚
â”‚ Storage: S3                                                         â”‚
â”‚ Processing time: 12 seconds                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Background Sync (Optional)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Sync to Google Drive (backup)                                     â”‚
â”‚ â€¢ Sync to Backblaze B2 (archive)                                    â”‚
â”‚ â€¢ Update storage_registry with backup URLs                          â”‚
â”‚ â€¢ Sync to legal_documents table                                     â”‚
â”‚ â€¢ Export to Airtable (external review)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                          COMPLETE
```

### Monitoring Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTINUOUS MONITORING (Every 5 min)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ telegram_monitoring_bot.py                      â”‚
â”‚                                                 â”‚
â”‚ async def check_all_services():                â”‚
â”‚   github_status = get_github_status()          â”‚
â”‚   n8n_status = get_n8n_status()                â”‚
â”‚   qdrant_status = get_qdrant_status()          â”‚
â”‚   twelve_status = get_twelve_labs_status()     â”‚
â”‚                                                 â”‚
â”‚   aggregate_health = calculate_health()        â”‚
â”‚                                                 â”‚
â”‚   if degraded:                                 â”‚
â”‚     send_alert()                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Calls (Parallel)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ GitHub API:                                     â”‚
â”‚ â€¢ GET /repos/{owner}/{repo}/commits             â”‚
â”‚ â€¢ GET /repos/{owner}/{repo}/pulls               â”‚
â”‚ â€¢ GET /repos/{owner}/{repo}/issues              â”‚
â”‚ â€¢ GET /repos/{owner}/{repo}/actions/runs        â”‚
â”‚                                                 â”‚
â”‚ n8n API:                                        â”‚
â”‚ â€¢ GET /workflows                                â”‚
â”‚ â€¢ GET /executions                               â”‚
â”‚                                                 â”‚
â”‚ Qdrant API:                                     â”‚
â”‚ â€¢ GET /collections                              â”‚
â”‚ â€¢ GET /collections/{name}                       â”‚
â”‚                                                 â”‚
â”‚ Twelve Labs API:                                â”‚
â”‚ â€¢ GET /indexes                                  â”‚
â”‚ â€¢ GET /tasks                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aggregate Results                               â”‚
â”‚                                                 â”‚
â”‚ {                                               â”‚
â”‚   "github": {                                   â”‚
â”‚     "commits_24h": 5,                          â”‚
â”‚     "open_prs": 2,                             â”‚
â”‚     "workflow_failures": 0,                    â”‚
â”‚     "health": "ğŸŸ¢ HEALTHY"                    â”‚
â”‚   },                                            â”‚
â”‚   "n8n": {                                      â”‚
â”‚     "active_workflows": 2,                     â”‚
â”‚     "failed_executions": 1,                    â”‚
â”‚     "success_rate": 95.5,                      â”‚
â”‚     "health": "ğŸŸ¢ HEALTHY"                    â”‚
â”‚   },                                            â”‚
â”‚   ...                                           â”‚
â”‚ }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Deliver to User (Telegram)                      â”‚
â”‚                                                 â”‚
â”‚ User sends: /status_all                         â”‚
â”‚                                                 â”‚
â”‚ Bot responds:                                   â”‚
â”‚ ğŸ“Š **System Status**                           â”‚
â”‚                                                 â”‚
â”‚ ğŸ™ GitHub: ğŸŸ¢ HEALTHY                         â”‚
â”‚ â€¢ 5 commits (24h)                              â”‚
â”‚ â€¢ 2 open PRs                                   â”‚
â”‚                                                 â”‚
â”‚ âš™ï¸ n8n: ğŸŸ¢ HEALTHY                           â”‚
â”‚ â€¢ 2 active workflows                           â”‚
â”‚ â€¢ 95.5% success rate                           â”‚
â”‚                                                 â”‚
â”‚ ... (more services)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

### Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  telegram_uploads    â”‚  â—„â”€â”€â”€â”€â”€â”
â”‚  (Source of Truth)   â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ PK: id (UUID)        â”‚        â”‚
â”‚     telegram_user_id â”‚        â”‚  1:N
â”‚     file_id          â”‚        â”‚
â”‚     document_type    â”‚        â”‚
â”‚     status           â”‚        â”‚
â”‚     created_at       â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
           â”‚                    â”‚
           â”‚ 1                  â”‚
           â”‚                    â”‚
           â”‚ N                  â”‚
           â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  processing_logs     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (Audit Trail)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (BIGSERIAL)   â”‚
â”‚ FK: telegram_upload_id
â”‚     stage            â”‚
â”‚     status           â”‚
â”‚     logged_at        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  storage_registry    â”‚
â”‚  (File Locations)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (UUID)        â”‚
â”‚     file_hash        â”‚
â”‚     primary_url      â”‚
â”‚     backup_url       â”‚
â”‚     archive_url      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  notification_queue  â”‚
â”‚  (Async Messaging)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (BIGSERIAL)   â”‚
â”‚     telegram_user_id â”‚
â”‚     message          â”‚
â”‚     status           â”‚
â”‚     priority         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  legal_documents     â”‚
â”‚  (Final Docs)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (UUID)        â”‚
â”‚     document_type    â”‚
â”‚     upload_date      â”‚
â”‚     file_path        â”‚
â”‚     relevancy_score  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  user_preferences    â”‚
â”‚  (User Settings)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: telegram_user_id â”‚
â”‚     notify_on_upload â”‚
â”‚     auto_process     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Table Specifications

#### telegram_uploads
**Purpose:** Source of truth for all uploads

```sql
CREATE TABLE telegram_uploads (
    -- Identity
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    telegram_user_id BIGINT NOT NULL,
    telegram_chat_id BIGINT,

    -- File Info
    file_id TEXT NOT NULL,
    file_type TEXT NOT NULL CHECK (file_type IN ('photo', 'document', 'audio', 'video', 'voice')),
    file_size BIGINT,
    original_filename TEXT,

    -- Document Metadata
    document_type TEXT CHECK (document_type IN ('PLCR', 'DECL', 'EVID', 'CORR', 'CRDR', 'MISC')),
    document_title TEXT,
    document_date DATE,
    user_notes TEXT,
    relevancy_score INTEGER CHECK (relevancy_score >= 0 AND relevancy_score <= 1000),

    -- Processing Status
    status TEXT NOT NULL DEFAULT 'received'
        CHECK (status IN ('received', 'processing', 'completed', 'failed')),

    -- Storage
    permanent_storage_url TEXT,
    storage_provider TEXT CHECK (storage_provider IN ('s3', 'google_drive', 'backblaze')),

    -- Processing Metrics
    processing_started_at TIMESTAMP WITH TIME ZONE,
    processing_completed_at TIMESTAMP WITH TIME ZONE,
    processing_duration_seconds INTEGER,

    -- Error Tracking
    error_message TEXT,
    error_details JSONB,
    retry_count INTEGER DEFAULT 0,

    -- Metadata
    metadata JSONB,
    tags TEXT[],

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_telegram_uploads_user_id ON telegram_uploads(telegram_user_id);
CREATE INDEX idx_telegram_uploads_status ON telegram_uploads(status);
CREATE INDEX idx_telegram_uploads_created_at ON telegram_uploads(created_at DESC);
CREATE INDEX idx_telegram_uploads_document_type ON telegram_uploads(document_type);
CREATE INDEX idx_telegram_uploads_document_date ON telegram_uploads(document_date);
CREATE INDEX idx_telegram_uploads_relevancy ON telegram_uploads(relevancy_score DESC);

-- Full-text search
CREATE INDEX idx_telegram_uploads_search ON telegram_uploads
    USING gin(to_tsvector('english',
        COALESCE(document_title, '') || ' ' ||
        COALESCE(user_notes, '')
    ));
```

#### processing_logs
**Purpose:** Complete audit trail

```sql
CREATE TABLE processing_logs (
    id BIGSERIAL PRIMARY KEY,
    telegram_upload_id UUID REFERENCES telegram_uploads(id) ON DELETE CASCADE,

    stage TEXT NOT NULL CHECK (stage IN (
        'validation', 'storage', 'extraction',
        'enhancement', 'notification', 'sync'
    )),

    status TEXT NOT NULL CHECK (status IN ('started', 'completed', 'failed')),

    message TEXT,
    error_details JSONB,

    duration_ms INTEGER,

    metadata JSONB,

    logged_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_processing_logs_upload_id ON processing_logs(telegram_upload_id);
CREATE INDEX idx_processing_logs_stage ON processing_logs(stage);
CREATE INDEX idx_processing_logs_status ON processing_logs(status);
CREATE INDEX idx_processing_logs_logged_at ON processing_logs(logged_at DESC);
```

### RLS Policies

**Row Level Security ensures users only see their own data:**

```sql
-- Enable RLS
ALTER TABLE telegram_uploads ENABLE ROW LEVEL SECURITY;
ALTER TABLE processing_logs ENABLE ROW LEVEL SECURITY;

-- Policies for telegram_uploads
CREATE POLICY "Users can view own uploads"
    ON telegram_uploads
    FOR SELECT
    USING (telegram_user_id = current_setting('app.user_id')::BIGINT);

CREATE POLICY "Users can insert own uploads"
    ON telegram_uploads
    FOR INSERT
    WITH CHECK (telegram_user_id = current_setting('app.user_id')::BIGINT);

-- Service role bypass (for n8n workflows)
CREATE POLICY "Service role full access"
    ON telegram_uploads
    FOR ALL
    USING (current_setting('role') = 'service_role');
```

---

## API Specifications

### Telegram Bot API

**Base URL:** `https://api.telegram.org/bot{token}/`

**Methods Used:**
```
GET  /getUpdates           â†’ Long polling for messages
POST /sendMessage          â†’ Send text messages
POST /sendPhoto            â†’ Send images
POST /getFile              â†’ Get file path
POST /answerCallbackQuery  â†’ Respond to button clicks
```

**Authentication:**
- Bot token in URL
- No additional headers needed

### Supabase REST API

**Base URL:** `https://{project}.supabase.co/rest/v1/`

**Headers:**
```
apikey: {anon_key}
Authorization: Bearer {service_role_key}
Content-Type: application/json
Prefer: return=representation
```

**Operations:**
```
GET    /telegram_uploads        â†’ List uploads
POST   /telegram_uploads        â†’ Create upload
PATCH  /telegram_uploads?id=eq.{uuid} â†’ Update upload
DELETE /telegram_uploads?id=eq.{uuid} â†’ Delete upload

POST   /rpc/log_processing_stage â†’ Custom function
POST   /rpc/queue_notification   â†’ Custom function
```

### n8n Webhook API

**Endpoint:** `https://{n8n-instance}/webhook/{path}`

**Method:** POST

**Request:**
```json
{
  "upload_id": "a1b2c3d4-5678-90ef-ghij-klmnopqrstuv",
  "file_id": "AgACAgIAAxkBAAI...",
  "file_type": "photo",
  "telegram_user_id": 123456789
}
```

**Response:**
```json
{
  "success": true,
  "upload_id": "a1b2c3d4-...",
  "status": "completed"
}
```

### Claude API

**Base URL:** `https://api.anthropic.com/v1/`

**Headers:**
```
x-api-key: {api_key}
anthropic-version: 2023-06-01
Content-Type: application/json
```

**Endpoint:** POST `/messages`

**Request:**
```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 4000,
  "messages": [
    {
      "role": "user",
      "content": "Analyze this document..."
    }
  ]
}
```

**Response:**
```json
{
  "id": "msg_...",
  "type": "message",
  "role": "assistant",
  "content": [
    {
      "type": "text",
      "text": "Analysis results..."
    }
  ],
  "model": "claude-sonnet-4-20250514",
  "usage": {
    "input_tokens": 1523,
    "output_tokens": 892
  }
}
```

---

## Security Architecture

### Authentication & Authorization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUTHENTICATION LAYERS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Layer 1: Telegram Bot                   â”‚
â”‚ â€¢ User authenticated by Telegram        â”‚
â”‚ â€¢ Bot token validates requests          â”‚
â”‚ â€¢ telegram_user_id as identity          â”‚
â”‚                                          â”‚
â”‚ Layer 2: Supabase RLS                   â”‚
â”‚ â€¢ Row-level security policies           â”‚
â”‚ â€¢ Service role for n8n                  â”‚
â”‚ â€¢ Anon role for dashboards              â”‚
â”‚                                          â”‚
â”‚ Layer 3: API Keys                       â”‚
â”‚ â€¢ Claude API key (ANTHROPIC_API_KEY)    â”‚
â”‚ â€¢ GitHub PAT (GITHUB_TOKEN)             â”‚
â”‚ â€¢ AWS credentials (IAM role)            â”‚
â”‚ â€¢ Qdrant API key                        â”‚
â”‚                                          â”‚
â”‚ Layer 4: Webhook Authentication         â”‚
â”‚ â€¢ Secret tokens for n8n webhooks        â”‚
â”‚ â€¢ IP whitelist (optional)               â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Encryption

**At Rest:**
- Supabase: AES-256 encryption
- AWS S3: SSE-S3 or SSE-KMS
- Google Drive: Google-managed encryption
- Backblaze B2: AES-256 encryption

**In Transit:**
- All API calls: HTTPS/TLS 1.2+
- Database connections: SSL/TLS
- Webhook calls: HTTPS only

### Secret Management

**Environment Variables (Production):**
```bash
# Never commit these!
SUPABASE_URL=https://...
SUPABASE_KEY=eyJ...
TELEGRAM_BOT_TOKEN=123456789:ABC...
ANTHROPIC_API_KEY=sk-ant-...
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
```

**Secrets Storage:**
- Development: `.env` file (gitignored)
- Streamlit: `.streamlit/secrets.toml`
- Production: AWS Secrets Manager / Environment variables

### Access Control Matrix

| Resource | Telegram User | Service Role (n8n) | Dashboard | Shepherd Agent |
|----------|---------------|-------------------|-----------|----------------|
| telegram_uploads (own) | Read, Write | Full | Read | Read |
| telegram_uploads (others) | None | Full | None | Read |
| processing_logs | None | Full | Read | Read |
| storage_registry | None | Full | Read | Read |
| notification_queue | None | Full | Read | None |
| legal_documents | Read (own) | Full | Read | Read |

---

## Deployment Architecture

### Production Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PRODUCTION                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Telegram Bots      â”‚     â”‚   n8n (Cloud)        â”‚       â”‚
â”‚  â”‚                     â”‚     â”‚                      â”‚       â”‚
â”‚  â”‚  â€¢ systemd service  â”‚     â”‚  â€¢ 2 workflows       â”‚       â”‚
â”‚  â”‚  â€¢ Auto-restart     â”‚     â”‚  â€¢ Active 24/7       â”‚       â”‚
â”‚  â”‚  â€¢ Log rotation     â”‚     â”‚  â€¢ Webhook endpoint  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Dashboards         â”‚     â”‚  Shepherd Agent      â”‚       â”‚
â”‚  â”‚                     â”‚     â”‚                      â”‚       â”‚
â”‚  â”‚  â€¢ Streamlit Cloud  â”‚     â”‚  â€¢ Docker container  â”‚       â”‚
â”‚  â”‚  â€¢ Auto-scale       â”‚     â”‚  â€¢ Cron jobs         â”‚       â”‚
â”‚  â”‚  â€¢ CDN caching      â”‚     â”‚  â€¢ CLI access        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚            Database & Storage                    â”‚        â”‚
â”‚  â”‚                                                   â”‚        â”‚
â”‚  â”‚  Supabase:          AWS S3:        Qdrant:       â”‚        â”‚
â”‚  â”‚  â€¢ Primary region   â€¢ us-east-1    â€¢ Cloud       â”‚        â”‚
â”‚  â”‚  â€¢ PITR enabled     â€¢ Versioning   â€¢ 1 cluster   â”‚        â”‚
â”‚  â”‚  â€¢ Daily backups    â€¢ Lifecycle    â€¢ Backups     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Systemd Service (Telegram Bots)

```ini
# /etc/systemd/system/aseagi-telegram-bot.service
[Unit]
Description=ASEAGI Telegram Document Bot
After=network.target

[Service]
Type=simple
User=aseagi
WorkingDirectory=/opt/aseagi
Environment="PYTHONUNBUFFERED=1"
EnvironmentFile=/opt/aseagi/.env
ExecStart=/opt/aseagi/venv/bin/python telegram_document_bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### Docker Deployment (Shepherd Agent)

```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY claude_shepherd_agent.py .

CMD ["python", "claude_shepherd_agent.py"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  shepherd:
    build: .
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      - QDRANT_URL=${QDRANT_URL}
    volumes:
      - ./data:/app/data
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped

volumes:
  qdrant_data:
```

---

## Integration Points

### External Services

| Service | Purpose | Protocol | Authentication |
|---------|---------|----------|----------------|
| Telegram Bot API | User interface | HTTPS/REST | Bot token |
| Supabase | Database | PostgreSQL/REST | API key + RLS |
| AWS S3 | Primary storage | HTTPS/S3 API | IAM credentials |
| Google Drive | Backup storage | HTTPS/REST | OAuth 2.0 |
| Backblaze B2 | Archive storage | HTTPS/S3-compatible | Application key |
| n8n | Workflow automation | HTTPS/Webhook | API key |
| Anthropic Claude | AI analysis | HTTPS/REST | API key |
| GitHub | Code repository | HTTPS/REST | Personal access token |
| Qdrant | Vector database | HTTPS/gRPC | API key |
| Twelve Labs | Video AI | HTTPS/REST | API key |
| Airtable | External review | HTTPS/REST | API key |

---

## Scalability & Performance

### Current Capacity

- **Uploads:** 1000/day
- **Storage:** Unlimited (cloud)
- **Database:** 500 concurrent connections
- **API Rate Limits:**
  - Telegram: 30 messages/second
  - Claude: 50 requests/minute
  - Supabase: 100 req/sec (free tier)

### Scaling Strategies

**Horizontal Scaling:**
- Multiple bot instances (load balanced)
- n8n workflow parallelization
- Qdrant cluster (multiple nodes)

**Vertical Scaling:**
- Upgrade Supabase tier
- Larger Qdrant instances
- More Claude API quota

**Caching:**
- Redis for dashboard queries
- Qdrant caching for common searches
- CDN for static assets

---

## Disaster Recovery

### Backup Strategy

**Database:**
- Supabase PITR (Point-in-Time Recovery): 7 days
- Daily full backups to S3
- Retention: 30 days

**File Storage:**
- Multi-tier redundancy (3 copies)
- S3 versioning enabled
- Cross-region replication (optional)

**Recovery Objectives:**
- **RTO** (Recovery Time Objective): 4 hours
- **RPO** (Recovery Point Objective): 5 minutes

### Failure Scenarios

| Scenario | Impact | Recovery |
|----------|--------|----------|
| Telegram API down | No new uploads | Queue locally, process when restored |
| Supabase outage | No database access | Failover to backup connection string |
| S3 outage | Upload failures | Fallback to Google Drive |
| n8n crash | Processing stops | Auto-restart via systemd/Docker |
| Bot crash | No user interface | Auto-restart, users can retry |

---

**Last Updated:** 2025-11-06
**Version:** 1.0
**Maintained By:** ASEAGI Development Team
