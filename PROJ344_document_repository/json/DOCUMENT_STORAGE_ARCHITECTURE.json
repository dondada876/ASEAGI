{
  "metadata": {
    "file_path": "C:\\Users\\DonBucknor_n0ufqwv\\GettingStarted\\ASEAGI\\DOCUMENT_STORAGE_ARCHITECTURE.md",
    "file_name": "DOCUMENT_STORAGE_ARCHITECTURE.md",
    "file_type": "md",
    "file_size": 8064,
    "file_hash": "5750e93d52934933a0a64184cfe1b8ed",
    "extraction_date": "2025-11-06T09:18:56.645003",
    "extraction_method": "direct_read",
    "title": "# Document Storage Architecture - ASEAGI",
    "author": null,
    "created_date": "2025-11-05T21:30:09.315302",
    "modified_date": "2025-11-05T21:30:09.315302",
    "page_count": null,
    "word_count": 1100,
    "char_count": 7597
  },
  "content": "# Document Storage Architecture - ASEAGI\n\n## Overview\nMulti-tier storage system optimized for fast viewing, AI processing, and long-term archival.\n\n---\n\n## Architecture\n\n### Upload Flow\n```\n1. Telegram â†’ Image received\n2. Claude Vision API â†’ Extract metadata, OCR, verify duplicates\n3. Supabase Storage â†’ Save full image + thumbnail\n4. Supabase Database â†’ Save metadata + extracted text\n5. Google Drive â†’ Nightly backup (optional)\n```\n\n---\n\n## Storage Tiers\n\n### Tier 1: Fast Access (Supabase Storage)\n**Purpose:** Immediate viewing and reference\n\n**What's Stored:**\n- Thumbnails (200x200px) - ~20KB each\n- Optimized images (1200px width) - ~200KB each\n- Recent documents (last 90 days)\n\n**Access Speed:** <100ms via CDN\n\n**Bucket Structure:**\n```\ndocuments/\nâ”œâ”€â”€ thumbnails/\nâ”‚   â””â”€â”€ 20240804_RichmondPD_PLCR_xxx_thumb.jpg\nâ”œâ”€â”€ optimized/\nâ”‚   â””â”€â”€ 20240804_RichmondPD_PLCR_xxx_opt.jpg\nâ””â”€â”€ originals/\n    â””â”€â”€ 20240804_RichmondPD_PLCR_xxx.jpg\n```\n\n**Cost:** Free up to 100GB, then $0.021/GB/month\n\n---\n\n### Tier 2: Database (Supabase PostgreSQL)\n**Purpose:** Fast search, metadata, and extracted text\n\n**What's Stored:**\n- OCR extracted text (full_text_content)\n- Claude Vision analysis (executive_summary)\n- Metadata (dates, types, relevancy)\n- File references (URLs to Supabase Storage)\n- Duplicate detection (file_hash)\n\n**Table: legal_documents**\n```sql\nKey columns:\n- file_path: URL to original image in Supabase Storage\n- thumbnail_path: URL to thumbnail\n- full_text_content: OCR extracted text\n- executive_summary: Claude Vision analysis\n- file_hash: MD5 hash for duplicate detection\n- document_date: Extracted or user-provided date\n- relevancy_number: Importance score\n```\n\n**Access Speed:** <50ms for metadata queries\n\n**Cost:** Free up to 500MB database, then $25/month (Pro tier)\n\n---\n\n### Tier 3: Archive (Google Drive)\n**Purpose:** Legal compliance and disaster recovery\n\n**What's Stored:**\n- Monthly backups of all documents\n- Original unmodified files\n- Export of database (JSON/CSV)\n\n**Folder Structure:**\n```\nASEAGI Archive/\nâ”œâ”€â”€ 2024/\nâ”‚   â”œâ”€â”€ 08-August/\nâ”‚   â”‚   â”œâ”€â”€ Police Reports/\nâ”‚   â”‚   â””â”€â”€ Declarations/\nâ”‚   â””â”€â”€ 09-September/\nâ””â”€â”€ Database Exports/\n    â””â”€â”€ 2024-08-31_export.json\n```\n\n**Access Speed:** Not critical (archival only)\n\n**Cost:** $6-12/month (Google Workspace)\n\n---\n\n## Claude Vision AI Integration\n\n### What Claude Analyzes:\n1. **Document Type Detection**\n   - Police report, court order, declaration, etc.\n   - Confidence score\n\n2. **Date Extraction**\n   - Look for dates in document\n   - Format: MM/DD/YYYY, YYYYMMDD, written dates\n   - If none found: \"Unknown\"\n\n3. **Key Information**\n   - Names mentioned\n   - Incident details\n   - Important quotes\n   - Case numbers\n\n4. **Duplicate Detection**\n   - Compare with existing documents\n   - Check similar content\n   - Flag if likely duplicate\n\n5. **Relevancy Scoring**\n   - Analyze importance based on content\n   - Auto-score 600-920\n   - Keywords: \"sexual assault\", \"critical\", \"evidence\"\n\n### Example Claude Vision Prompt:\n```\nAnalyze this legal document image:\n\n1. Document type (Police Report, Court Order, etc.)\n2. Extract any dates (format: YYYYMMDD or \"Unknown\")\n3. Extract key information:\n   - Names mentioned\n   - Case/Report numbers\n   - Incident details\n   - Important facts\n4. Summarize in 2-3 sentences\n5. Suggest relevancy score (600-920) based on:\n   - Evidence of abuse/assault: 900+\n   - Court orders: 800-900\n   - Administrative: 700-800\n   - Other: 600-700\n\nReturn JSON format.\n```\n\n---\n\n## Workflow Improvements\n\n### Option A: Smart Quick Upload (Recommended)\n**User Experience:**\n```\nYou: [Send image with caption]\n     \"Richmond PD 24-7889 - Initial sexual assault report\"\n\nBot: ðŸ” Analyzing with Claude Vision...\n     âœ… Detected: Police Report\n     ðŸ“… Date: 2024-08-04 (extracted from image)\n     ðŸ“„ Report #: 24-7889\n     â­ Relevancy: Critical (920) - Sexual assault allegation\n\n     Confirm upload? (Yes/No)\n\nYou: Yes\n\nBot: âœ… Uploaded!\n     ðŸ”— View: https://jvjlhxodmbkodzmggwpu.supabase.co/storage/...\n     ðŸ“Š Added to database (ID: 1234)\n```\n\n**Steps:**\n1. Send image (with or without caption)\n2. Claude Vision analyzes automatically\n3. Bot shows extracted info\n4. You confirm or edit\n5. Uploaded\n\n### Option B: Detailed Interview (Current)\nKeep current 7-step process for complex documents where you want manual control.\n\n### Option C: Hybrid (Best of Both)\n```\nBot: How would you like to upload?\n     1ï¸âƒ£ Quick (AI analyzes)\n     2ï¸âƒ£ Detailed (manual entry)\n\nYou: 1\n\n[Quick upload flow]\n```\n\n---\n\n## Duplicate Detection Strategy\n\n### Three-Level Check:\n\n**Level 1: File Hash**\n- MD5 hash of image bytes\n- Exact duplicate detection\n- Instant (database query)\n\n**Level 2: Visual Similarity**\n- Compare thumbnails with perceptual hash\n- Catch rescanned/rephotographed docs\n- ~500ms per comparison\n\n**Level 3: Content Similarity**\n- Compare OCR text with fuzzy matching\n- Catch different scans of same document\n- Uses PostgreSQL full-text search\n\n### Example:\n```\nBot: âš ï¸ Possible duplicate found!\n\n     Existing: 240804_RichmondPD_PLCR_Report_24-7889.jpg\n     Uploaded: 2024-08-05\n     Similarity: 95%\n\n     Options:\n     1. Skip (keep existing)\n     2. Replace (use new version)\n     3. Keep both (mark as versions)\n```\n\n---\n\n## Cost Breakdown (Monthly)\n\n### Small Scale (<100GB, <10k docs)\n- Supabase Storage: **Free** (100GB included)\n- Supabase Database: **Free** (500MB included)\n- Claude Vision API: **$5-10** (~100 documents/month)\n- Google Drive Backup: **$6** (optional)\n- **Total: $5-16/month**\n\n### Medium Scale (100-500GB, 10k-50k docs)\n- Supabase Storage: **$8** (400GB)\n- Supabase Database: **$25** (Pro tier)\n- Claude Vision API: **$20-30** (~500 documents/month)\n- Google Drive Backup: **$12** (2TB)\n- **Total: $65-75/month**\n\n### Large Scale (500GB+, 50k+ docs)\n- Supabase Storage: **$21** (1TB)\n- Supabase Database: **$25** (Pro tier)\n- Claude Vision API: **$50** (~1000 documents/month)\n- Google Drive Backup: **$12** (2TB)\n- **Total: $108/month**\n\n**Your Current: ~400 docs = Small Scale = $5-16/month**\n\n---\n\n## Implementation Priority\n\n### Phase 1: Core Infrastructure (Week 1)\n- [ ] Set up Supabase Storage bucket\n- [ ] Configure public URL access\n- [ ] Update bot to save images to Supabase\n- [ ] Generate thumbnails\n\n### Phase 2: AI Integration (Week 2)\n- [ ] Add Claude Vision API\n- [ ] Implement auto-extraction\n- [ ] Add duplicate detection\n- [ ] Smart quick upload workflow\n\n### Phase 3: Optimization (Week 3)\n- [ ] Image compression\n- [ ] Thumbnail generation\n- [ ] Fast dashboard preview\n- [ ] Search index optimization\n\n### Phase 4: Archive (Week 4)\n- [ ] Google Drive integration\n- [ ] Automated backups\n- [ ] Export functionality\n- [ ] Lifecycle policies\n\n---\n\n## Recommendation\n\n**Use Hybrid Multi-Tier Architecture with:**\n\n1. âœ… **Supabase Storage** for primary storage (fast, integrated)\n2. âœ… **Claude Vision AI** for auto-extraction and analysis\n3. âœ… **Supabase Database** for metadata and search\n4. âœ… **Google Drive** for monthly backups (legal compliance)\n5. âœ… **Smart Quick Upload** as default (Option A)\n6. âœ… **Detailed Interview** available for complex docs\n\n**Why This Works:**\n- Fast viewing (<100ms thumbnails)\n- Intelligent processing (Claude Vision)\n- Duplicate detection (3-level check)\n- Cost-effective ($5-16/month for your scale)\n- Legally compliant (Google Drive backup)\n- Scalable (handles growth to 50k+ docs)\n\n---\n\n## Next Steps\n\nWould you like me to:\n1. Implement the Supabase Storage integration?\n2. Add Claude Vision AI processing?\n3. Build the smart quick upload workflow?\n4. All of the above?\n\nLet me know and I'll start implementing!\n",
  "content_preview": "# Document Storage Architecture - ASEAGI\n\n## Overview\nMulti-tier storage system optimized for fast viewing, AI processing, and long-term archival.\n\n---\n\n## Architecture\n\n### Upload Flow\n```\n1. Telegram â†’ Image received\n2. Claude Vision API â†’ Extract metadata, OCR, verify duplicates\n3. Supabase Storage â†’ Save full image + thumbnail\n4. Supabase Database â†’ Save metadata + extracted text\n5. Google Drive â†’ Nightly backup (optional)\n```\n\n---\n\n## Storage Tiers\n\n### Tier 1: Fast Access (Supabase Storage...",
  "sections": [
    {
      "title": "Document Storage Architecture - ASEAGI",
      "content": ""
    },
    {
      "title": "Overview",
      "content": "Multi-tier storage system optimized for fast viewing, AI processing, and long-term archival.\n---"
    },
    {
      "title": "Architecture",
      "content": ""
    },
    {
      "title": "Upload Flow",
      "content": "```\n1. Telegram â†’ Image received\n2. Claude Vision API â†’ Extract metadata, OCR, verify duplicates\n3. Supabase Storage â†’ Save full image + thumbnail\n4. Supabase Database â†’ Save metadata + extracted text\n5. Google Drive â†’ Nightly backup (optional)\n```\n---"
    },
    {
      "title": "Storage Tiers",
      "content": ""
    },
    {
      "title": "Tier 1: Fast Access (Supabase Storage)",
      "content": "**Purpose:** Immediate viewing and reference\n**What's Stored:**\n- Thumbnails (200x200px) - ~20KB each\n- Optimized images (1200px width) - ~200KB each\n- Recent documents (last 90 days)\n**Access Speed:** <100ms via CDN\n**Bucket Structure:**\n```\ndocuments/\nâ”œâ”€â”€ thumbnails/\nâ”‚   â””â”€â”€ 20240804_RichmondPD_PLCR_xxx_thumb.jpg\nâ”œâ”€â”€ optimized/\nâ”‚   â””â”€â”€ 20240804_RichmondPD_PLCR_xxx_opt.jpg\nâ””â”€â”€ originals/\n    â””â”€â”€ 20240804_RichmondPD_PLCR_xxx.jpg\n```\n**Cost:** Free up to 100GB, then $0.021/GB/month\n---"
    },
    {
      "title": "Tier 2: Database (Supabase PostgreSQL)",
      "content": "**Purpose:** Fast search, metadata, and extracted text\n**What's Stored:**\n- OCR extracted text (full_text_content)\n- Claude Vision analysis (executive_summary)\n- Metadata (dates, types, relevancy)\n- File references (URLs to Supabase Storage)\n- Duplicate detection (file_hash)\n**Table: legal_documents**\n```sql\nKey columns:\n- file_path: URL to original image in Supabase Storage\n- thumbnail_path: URL to thumbnail\n- full_text_content: OCR extracted text\n- executive_summary: Claude Vision analysis\n- file_hash: MD5 hash for duplicate detection\n- document_date: Extracted or user-provided date\n- relevancy_number: Importance score\n```\n**Access Speed:** <50ms for metadata queries\n**Cost:** Free up to 500MB database, then $25/month (Pro tier)\n---"
    },
    {
      "title": "Tier 3: Archive (Google Drive)",
      "content": "**Purpose:** Legal compliance and disaster recovery\n**What's Stored:**\n- Monthly backups of all documents\n- Original unmodified files\n- Export of database (JSON/CSV)\n**Folder Structure:**\n```\nASEAGI Archive/\nâ”œâ”€â”€ 2024/\nâ”‚   â”œâ”€â”€ 08-August/\nâ”‚   â”‚   â”œâ”€â”€ Police Reports/\nâ”‚   â”‚   â””â”€â”€ Declarations/\nâ”‚   â””â”€â”€ 09-September/\nâ””â”€â”€ Database Exports/\n    â””â”€â”€ 2024-08-31_export.json\n```\n**Access Speed:** Not critical (archival only)\n**Cost:** $6-12/month (Google Workspace)\n---"
    },
    {
      "title": "Claude Vision AI Integration",
      "content": ""
    },
    {
      "title": "What Claude Analyzes:",
      "content": "1. **Document Type Detection**\n   - Police report, court order, declaration, etc.\n   - Confidence score\n2. **Date Extraction**\n   - Look for dates in document\n   - Format: MM/DD/YYYY, YYYYMMDD, written dates\n   - If none found: \"Unknown\"\n3. **Key Information**\n   - Names mentioned\n   - Incident details\n   - Important quotes\n   - Case numbers\n4. **Duplicate Detection**\n   - Compare with existing documents\n   - Check similar content\n   - Flag if likely duplicate\n5. **Relevancy Scoring**\n   - Analyze importance based on content\n   - Auto-score 600-920\n   - Keywords: \"sexual assault\", \"critical\", \"evidence\""
    },
    {
      "title": "Example Claude Vision Prompt:",
      "content": "```\nAnalyze this legal document image:\n1. Document type (Police Report, Court Order, etc.)\n2. Extract any dates (format: YYYYMMDD or \"Unknown\")\n3. Extract key information:\n   - Names mentioned\n   - Case/Report numbers\n   - Incident details\n   - Important facts\n4. Summarize in 2-3 sentences\n5. Suggest relevancy score (600-920) based on:\n   - Evidence of abuse/assault: 900+\n   - Court orders: 800-900\n   - Administrative: 700-800\n   - Other: 600-700\nReturn JSON format.\n```\n---"
    },
    {
      "title": "Workflow Improvements",
      "content": ""
    },
    {
      "title": "Option A: Smart Quick Upload (Recommended)",
      "content": "**User Experience:**\n```\nYou: [Send image with caption]\n     \"Richmond PD 24-7889 - Initial sexual assault report\"\nBot: ðŸ” Analyzing with Claude Vision...\n     âœ… Detected: Police Report\n     ðŸ“… Date: 2024-08-04 (extracted from image)\n     ðŸ“„ Report #: 24-7889\n     â­ Relevancy: Critical (920) - Sexual assault allegation\n     Confirm upload? (Yes/No)\nYou: Yes\nBot: âœ… Uploaded!\n     ðŸ”— View: https://jvjlhxodmbkodzmggwpu.supabase.co/storage/...\n     ðŸ“Š Added to database (ID: 1234)\n```\n**Steps:**\n1. Send image (with or without caption)\n2. Claude Vision analyzes automatically\n3. Bot shows extracted info\n4. You confirm or edit\n5. Uploaded"
    },
    {
      "title": "Option B: Detailed Interview (Current)",
      "content": "Keep current 7-step process for complex documents where you want manual control."
    },
    {
      "title": "Option C: Hybrid (Best of Both)",
      "content": "```\nBot: How would you like to upload?\n     1ï¸âƒ£ Quick (AI analyzes)\n     2ï¸âƒ£ Detailed (manual entry)\nYou: 1\n[Quick upload flow]\n```\n---"
    },
    {
      "title": "Duplicate Detection Strategy",
      "content": ""
    },
    {
      "title": "Three-Level Check:",
      "content": "**Level 1: File Hash**\n- MD5 hash of image bytes\n- Exact duplicate detection\n- Instant (database query)\n**Level 2: Visual Similarity**\n- Compare thumbnails with perceptual hash\n- Catch rescanned/rephotographed docs\n- ~500ms per comparison\n**Level 3: Content Similarity**\n- Compare OCR text with fuzzy matching\n- Catch different scans of same document\n- Uses PostgreSQL full-text search"
    },
    {
      "title": "Example:",
      "content": "```\nBot: âš ï¸ Possible duplicate found!\n     Existing: 240804_RichmondPD_PLCR_Report_24-7889.jpg\n     Uploaded: 2024-08-05\n     Similarity: 95%\n     Options:\n     1. Skip (keep existing)\n     2. Replace (use new version)\n     3. Keep both (mark as versions)\n```\n---"
    },
    {
      "title": "Cost Breakdown (Monthly)",
      "content": ""
    },
    {
      "title": "Small Scale (<100GB, <10k docs)",
      "content": "- Supabase Storage: **Free** (100GB included)\n- Supabase Database: **Free** (500MB included)\n- Claude Vision API: **$5-10** (~100 documents/month)\n- Google Drive Backup: **$6** (optional)\n- **Total: $5-16/month**"
    },
    {
      "title": "Medium Scale (100-500GB, 10k-50k docs)",
      "content": "- Supabase Storage: **$8** (400GB)\n- Supabase Database: **$25** (Pro tier)\n- Claude Vision API: **$20-30** (~500 documents/month)\n- Google Drive Backup: **$12** (2TB)\n- **Total: $65-75/month**"
    },
    {
      "title": "Large Scale (500GB+, 50k+ docs)",
      "content": "- Supabase Storage: **$21** (1TB)\n- Supabase Database: **$25** (Pro tier)\n- Claude Vision API: **$50** (~1000 documents/month)\n- Google Drive Backup: **$12** (2TB)\n- **Total: $108/month**\n**Your Current: ~400 docs = Small Scale = $5-16/month**\n---"
    },
    {
      "title": "Implementation Priority",
      "content": ""
    },
    {
      "title": "Phase 1: Core Infrastructure (Week 1)",
      "content": "- [ ] Set up Supabase Storage bucket\n- [ ] Configure public URL access\n- [ ] Update bot to save images to Supabase\n- [ ] Generate thumbnails"
    },
    {
      "title": "Phase 2: AI Integration (Week 2)",
      "content": "- [ ] Add Claude Vision API\n- [ ] Implement auto-extraction\n- [ ] Add duplicate detection\n- [ ] Smart quick upload workflow"
    },
    {
      "title": "Phase 3: Optimization (Week 3)",
      "content": "- [ ] Image compression\n- [ ] Thumbnail generation\n- [ ] Fast dashboard preview\n- [ ] Search index optimization"
    },
    {
      "title": "Phase 4: Archive (Week 4)",
      "content": "- [ ] Google Drive integration\n- [ ] Automated backups\n- [ ] Export functionality\n- [ ] Lifecycle policies\n---"
    },
    {
      "title": "Recommendation",
      "content": "**Use Hybrid Multi-Tier Architecture with:**\n1. âœ… **Supabase Storage** for primary storage (fast, integrated)\n2. âœ… **Claude Vision AI** for auto-extraction and analysis\n3. âœ… **Supabase Database** for metadata and search\n4. âœ… **Google Drive** for monthly backups (legal compliance)\n5. âœ… **Smart Quick Upload** as default (Option A)\n6. âœ… **Detailed Interview** available for complex docs\n**Why This Works:**\n- Fast viewing (<100ms thumbnails)\n- Intelligent processing (Claude Vision)\n- Duplicate detection (3-level check)\n- Cost-effective ($5-16/month for your scale)\n- Legally compliant (Google Drive backup)\n- Scalable (handles growth to 50k+ docs)\n---"
    },
    {
      "title": "Next Steps",
      "content": "Would you like me to:\n1. Implement the Supabase Storage integration?\n2. Add Claude Vision AI processing?\n3. Build the smart quick upload workflow?\n4. All of the above?\nLet me know and I'll start implementing!"
    }
  ],
  "extraction_success": true,
  "extraction_error": null
}