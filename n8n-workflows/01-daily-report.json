{
  "name": "ASEAGI Daily Case Report",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 8 * * *"
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Every Day at 8 AM",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "select",
        "table": "documents",
        "returnAll": true
      },
      "id": "supabase-get-docs",
      "name": "Get All Documents",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [450, 300],
      "credentials": {
        "supabaseApi": {
          "id": "REPLACE_WITH_YOUR_SUPABASE_CREDENTIAL_ID",
          "name": "ASEAGI Supabase"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const docs = $input.all();\n\nconst total = docs.length;\nconst critical = docs.filter(d => d.json.relevancy_score >= 900).length;\nconst important = docs.filter(d => d.json.relevancy_score >= 800).length;\nconst categories = {};\n\ndocs.forEach(doc => {\n  const cat = doc.json.category || 'Uncategorized';\n  categories[cat] = (categories[cat] || 0) + 1;\n});\n\nconst message = `ðŸ“Š **ASEAGI Daily Report**\\nðŸ“… ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}\\n\\n**Case J24-00478: Ashe Bucknor**\\n\\nðŸ“ Total Documents: ${total}\\nðŸŽ¯ Critical Evidence (900+): ${critical}\\nâš ï¸ Important Evidence (800+): ${important}\\n\\nðŸ“‚ **By Category:**\\n${Object.entries(categories).map(([cat, count]) => `â€¢ ${cat}: ${count}`).join('\\n')}\\n\\nðŸ”— **View Dashboards:**\\nâ€¢ Master: http://137.184.1.91:8501\\nâ€¢ Error Log: http://localhost:8501`;\n\nreturn [{ json: { message } }];"
      },
      "id": "format-message",
      "name": "Format Daily Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "chatId": "YOUR_TELEGRAM_CHAT_ID",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-send",
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [850, 300],
      "credentials": {
        "telegramApi": {
          "id": "REPLACE_WITH_YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "ASEAGI Bot"
        }
      }
    }
  ],
  "connections": {
    "Every Day at 8 AM": {
      "main": [[{ "node": "Get All Documents", "type": "main", "index": 0 }]]
    },
    "Get All Documents": {
      "main": [[{ "node": "Format Daily Message", "type": "main", "index": 0 }]]
    },
    "Format Daily Message": {
      "main": [[{ "node": "Send to Telegram", "type": "main", "index": 0 }]]
    }
  }
}
